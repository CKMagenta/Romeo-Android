<!doctype html>
<html>
<head>
<meta charset="utf-8">
<script src="lib/plugin/jquery-1.9.1.min.js"></script>
<script src="lib/plugin/d3.v3.min.js"></script>
<script src="lib/plugin/json2.js"></script>
<script src="lib/plugin/underscore-min.js"></script>
<script src="lib/plugin/excanvas.js"></script>
<script src="lib/plugin/jit.js"></script>
</head>

<body>
<div id="holder"></div>
<ul id="legend"></ul>
<div id="infovis"></div>    

<script>

var labelType, useGradients, nativeTextSupport, animate;

(function() {
  var ua = navigator.userAgent;
  var iStuff = ua.match(/iPhone/i) || ua.match(/iPad/i);
  var typeOfCanvas = typeof HTMLCanvasElement;
  var nativeCanvasSupport = (typeOfCanvas == 'object' || typeOfCanvas == 'function');
  textSupport = nativeCanvasSupport 
        && (typeof document.createElement('canvas').getContext('2d').fillText == 'function');
  //I'm setting this based on the fact that ExCanvas provides text support for IE
  //and that as of today iPhone/iPad current text support is lame
  labelType = (!nativeCanvasSupport || (textSupport && !iStuff))? 'Native' : 'HTML';
  nativeTextSupport = labelType == 'Native';
  useGradients = nativeCanvasSupport;
  animate = !(iStuff || !nativeCanvasSupport);
})();

var Log = {
  elem: false,
  write: function(text){
    if (!this.elem) 
      this.elem = document.getElementById('log');
    this.elem.innerHTML = text;
    this.elem.style.left = (500 - this.elem.offsetWidth / 2) + 'px';
  }
};


function init(){
	//init data
    
    //end
   
    /*
    setTimeout(function() {
      pieChart.updateJSON(json2);
    }, 3000);
*/
}








$(document).ready(function(e) {
	// {"isMultiple":1, "options":[1.3]}
	//[{"3":2,"1":2},{"2":1,"1":1,"3":1}],"nReceivers":3,"nResponders":3}
	// { "nReceivers" : 5, "nResponsers":7, result:[{"Option1":2, "Option2":2, "Option3":1}]}
		var givenJSON = '{ "nReceivers" : 7, "nResponders":5, "result":{"Option1":2, "Option2":2, "Option3":1}}';
		var givenData = JSON.parse(givenJSON);
		var nResponders = givenData.nResponders;
		var nReceivers = givenData.nReceivers;
		var result = givenData.result;
		var results = _.pairs(result);
		
		var data = Array();
		for(var i=0; i<results.length; i++) {
			data.push({"label":results[i][0], "values" : results[i][1]});
		}

  render(data);
});

$(document).bind('idxArrived', function(e) {
	var idx = document.idx;
	var HOST = "http://172.16.7.52/Projects/CI/index.php/";
	$.ajax({
		url:HOST+"Survey/getResultJsonp",
//		async:false,
//		crossDomain:true,
		data:{idx : idx},
		dataType:"jsonp",

		type:"GET",
		success: function(json) {
			render();
		},
		
		error : function(json) {
		}
		
	});
});

function pushSurveyIdx(idx) {
	document.idx = idx;
	$(document).trigger('idxArrived');
}

function render(givenData) {
	var colors = ["#AF0452", "#FF8500", "#008196", "#002787", "#4903C7"];
	
	var data = {
					'color':["#AF0452", "#FF8500", "#008196", "#002787", "#4903C7"],
	        'values': givenData
	    };
	    
	    var infovis = document.getElementById('infovis');
	    //init PieChart
	    pieChart = new $jit.PieChart({
	        injectInto: 'infovis',
	        animate: true,
	        offset: 60,
	        sliceOffset: 5,
	        labelOffset: 20,
	        type:'stacked:gradient',
	        updateHeights:false,
	        showLabels:true,
	        Label: {
	          size: 13,
	          family: 'Arial',
	          color: 'white'
	        },
	        Tips: {
	          'enable': true,
	          'onShow': function(tip, elem) {
	             tip.innerHTML = "<b>" + elem.label + "</b>: " + elem.value;
	          }
	        }
	    });
	    //load JSON data.
	    pieChart.loadJSON(data);


}
</script>
<style>

#infovis {
width : 500px;
height:500px;
}

</style>
</body>
</html>
